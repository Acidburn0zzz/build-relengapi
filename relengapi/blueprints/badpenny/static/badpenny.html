<!-- This Source Code Form is subject to the terms of the Mozilla Public
     License, v. 2.0. If a copy of the MPL was not distributed with this
     file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<div ng-app='badpenny' ng-controller="TasksController">
    <h1>Bad Penny Tasks <button class="pull-right btn btn-default" ng-click="refresh()">Refresh</button></h1>
    <div class="tasklist">
        <ul class="list-group">
            <li ng-repeat="task in tasks | orderBy:'name'" class="list-group-item">
            <status-icon
                bad-when="task.last_success == 0"
                good-when="task.last_success == 1"
                gray-when="task.last_success == -1"></status-icon>
            {{task.name}} <small class="text-muted">{{task.schedule}}</small>
            <!-- TODO: some nice twirldown here -->
            (<a href="#" ng-click="expandTask(task)">expand</a>)
            <ul class="list-group" ng-if="task.jobs != null">
                <li ng-repeat="job in task.jobs | orderBy:'created_at'" class="list-group-item">
                <!-- TODO: use a twirldown and a button -->
                <div class="pull-right">
                    <span ng-hide="job.logs">
                        [<a ng-click="expandJob(job)" href="#">logs</a>]
                    </span>
                    [<a href="/badpenny/jobs/{{job.id}}">details</a>]
                </div>
                <status-icon good-when="job.successful" bad-when="!job.successful"></status-icon>
                <small ng-if="!job.started_at">
                    Job created {{job.created_at | amDateFormat:'l LTS'}}, not started
                </small>
                <small ng-if="job.started_at && !job.completed_at">
                    Job started {{job.started_at | amDateFormat:'l LTS'}}, not finished yet
                </small>
                <small ng-if="job.completed_at">
                    Job started {{job.started_at | amDateFormat:'l LTS'}},
                    finished {{humanJobDuration(job)}}
                </small>
                <div ng-if="job.logs != null">
                    <pre>{{job.logs}}</pre>
                </div>
                </li>
            </ul>
            </li>
        </ul>
    </div>
</div>
