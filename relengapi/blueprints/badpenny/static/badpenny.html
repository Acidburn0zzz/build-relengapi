<!-- This Source Code Form is subject to the terms of the Mozilla Public
     License, v. 2.0. If a copy of the MPL was not distributed with this
     file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<div ng-app='badpenny' ng-controller="TasksController">
    <h1>Bad Penny Tasks <button class="pull-right btn btn-default" ng-click="refresh()">Refresh</button></h1>
    <div class="tasklist">
        <ul class="list-group">
            <li ng-repeat="task in tasks | orderBy:'name'" class="list-group-item">
            <span ng-class="{'text-muted': task.last_success == -1,
                'text-danger': task.last_success == 0,
                'text-success': task.last_success == 1}">
                <span class="glyphicon"
                    ng-class="{'glyphicon-question-sign': task.last_success == -1,
                    'glyphicon-minus-sign': task.last_success == 0,
                    'glyphicon-ok-sign': task.last_success == 1}"></span>
            </span>
            {{task.name}} <small class="text-muted">{{task.schedule}}</small>
            <!-- TODO: some nice twirldown here -->
            (<a href="#" ng-click="expandTask(task)">expand</a>)
            <!-- TODO: maybe transplant this DOM element, rather than showing/hiding? -->
            <ul class="list-group" ng-if="task.jobs != null">
                <li ng-repeat="job in task.jobs | orderBy:'created_at'" class="list-group-item">
                <div class="pull-right">
                    <span ng-hide="job.logs">
                        [<a ng-click="expandJob(job)" href="#">logs</a>]
                    </span>
                    [<a href="/badpenny/jobs/{{job.id}}">details</a>]
                </div>
                <!-- TODO: use a directive for this -->
                <span ng-class="{'text-danger': !job.successful,
                    'text-success': job.successful}">
                    <span class="glyphicon"
                        ng-class="{'glyphicon-minus-sign': !job.successful,
                        'glyphicon-ok-sign': job.successful}"></span>
                </span>
                <small ng-if="!job.started_at">
                    Job created {{job.created_at | amDateFormat:'l LTS'}}, not started
                </small>
                <small ng-if="job.started_at && !job.completed_at">
                    Job started {{job.started_at | amDateFormat:'l LTS'}}, not finished yet
                </small>
                <small ng-if="job.completed_at">
                    Job started {{job.started_at | amDateFormat:'l LTS'}},
                    finished {{humanJobDuration(job)}}
                </small>
                <div ng-if="job.logs != null">
                    <pre>{{job.logs}}</pre>
                </div>
                </li>
            </ul>
            </li>
        </ul>
    </div>
</div>
